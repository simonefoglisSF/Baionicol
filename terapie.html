<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terapie | BAIONICOL</title>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="stylesheet" href="baionicol-core.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Space+Grotesk:wght@500;700&family=VT323&display=swap" rel="stylesheet">
    
    <style>
      
        /* --- HUD OVERLAY --- */
        .hud-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 999; box-shadow: inset 0 0 150px rgba(0,0,0,0.95); overflow: hidden; }
        .hud-arc { position: absolute; top: -10vh; width: 15vw; height: 120vh; border-radius: 50%; opacity: 0.15; }
        .arc-left { left: -7.5vw; border-right: 3px solid var(--cyan-neon); filter: drop-shadow(0 0 10px var(--cyan-neon)); }
        .arc-right { right: -7.5vw; border-left: 3px solid var(--cyan-neon); filter: drop-shadow(0 0 10px var(--cyan-neon)); }

        /* --- CONTENITORE PRINCIPALE --- */
        .content-container { padding: 120px 4vw 40px 4vw; max-width: 1600px; margin: 0 auto; position: relative; z-index: 10; }
        .view-section { transition: opacity 0.5s ease, transform 0.5s ease; height: 100%;}
        .hidden { display: none !important; opacity: 0; transform: scale(0.95); }

        /* --- VISTA 1: MENU HUB --- */
        .hub-title { font-size: 48px; color: var(--cyan-neon); margin-bottom: 30px; text-shadow: 0 0 15px rgba(0, 243, 255, 0.3); text-align: center; letter-spacing: 2px; }
        .hub-layout { display: flex; align-items: center; justify-content: space-between; gap: 50px; min-height: 60vh; }

        .mascot-container { 
    flex: 1; 
    min-height: 500px; 
    position: relative; 
    background: radial-gradient(circle, rgba(0,243,255,0.06) 0%, transparent 60%); 
}

spline-viewer { 
    background-color: transparent !important; 
    pointer-events: auto; 
    position: absolute;
    top: 50%;
    left: 50%;
    width: 130%; 
    height: 130%;
    transform: translate(-50%, -50%); 
    /* Taglia ESATTAMENTE solo il quadratino del logo in basso a destra, lasciando intatto il resto */
    clip-path: polygon(0% 0%, 100% 0%, 100% calc(100% - 70px), calc(100% - 170px) calc(100% - 70px), calc(100% - 170px) 100%, 0% 100%);
}

        .options-container { flex: 1.2; display: flex; flex-direction: column; gap: 20px; }

        .therapy-btn { background: rgba(5, 5, 5, 0.7); border: 1px solid var(--glass-border); border-radius: 15px; padding: 30px 40px; display: flex; align-items: center; gap: 30px; cursor: pointer; backdrop-filter: blur(15px); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); text-align: left; position: relative; overflow: hidden; color: var(--text-main); box-shadow: 0 15px 30px rgba(0,0,0,0.5); }
        .therapy-btn::before { content: ''; position: absolute; left: 0; top: 0; width: 6px; height: 100%; background: var(--cyan-neon); transform: scaleY(0); transition: transform 0.3s ease; }
        .therapy-btn:hover { background: rgba(0, 243, 255, 0.08); border-color: var(--cyan-neon); box-shadow: 0 0 30px rgba(0, 243, 255, 0.2); transform: translateX(15px); }
        .therapy-btn:hover::before { transform: scaleY(1); }
        .therapy-btn h2 { font-size: 32px; margin-bottom: 8px; transition: color 0.3s; font-family: 'Space Grotesk', sans-serif;}
        .therapy-btn p { font-size: 18px; color: var(--text-muted); line-height: 1.4; }
        .therapy-icon-svg { width: 50px; height: 50px; flex-shrink: 0; filter: drop-shadow(0 0 10px currentColor); transition: all 0.3s ease; }
        
        .btn-tessuti { color: var(--cyan-neon); } .btn-tessuti:hover h2, .btn-tessuti:hover .therapy-icon-svg { color: var(--cyan-neon); stroke: var(--cyan-neon); }
        .btn-specchio { color: var(--green-neon); } .btn-specchio::before { background: var(--green-neon); } .btn-specchio:hover { border-color: var(--green-neon); box-shadow: 0 0 30px rgba(57, 255, 20, 0.2); } .btn-specchio:hover h2, .btn-specchio:hover .therapy-icon-svg { color: var(--green-neon); stroke: var(--green-neon); }
        .btn-elettro { color: var(--warning-neon); } .btn-elettro::before { background: var(--warning-neon); } .btn-elettro:hover { border-color: var(--warning-neon); box-shadow: 0 0 30px rgba(255, 51, 102, 0.2); } .btn-elettro:hover h2, .btn-elettro:hover .therapy-icon-svg { color: var(--warning-neon); stroke: var(--warning-neon); }

        /* --- VISTA DETTAGLIO TERAPIA (LAYOUT ZERO-SCROLL) --- */
        .therapy-display { display: flex; justify-content: space-between; align-items: stretch; height: 80vh; background: rgba(5, 5, 5, 0.7); border: 1px solid var(--glass-border); border-radius: 20px; backdrop-filter: blur(15px); box-shadow: 0 20px 50px rgba(0,0,0,0.6); overflow: hidden; }

        .video-side { flex: 0 0 45%; width: 45%; background: rgba(0,0,0,0.85); border-right: 2px solid var(--glass-border); position: relative; display: flex; justify-content: center; align-items: center; box-shadow: inset 0 0 60px rgba(0, 243, 255, 0.05); }
        .video-placeholder-text { position: absolute; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--cyan-neon); font-family: 'VT323', monospace; font-size: 26px; text-align: center; letter-spacing: 3px; animation: pulseText 2s infinite; opacity: 0.6; z-index: 2; }
        .video-placeholder-text svg { width: 60px; height: 60px; margin-bottom: 15px; opacity: 0.8; }
        @keyframes pulseText { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; text-shadow: 0 0 15px currentColor; } }
        .video-side video { width: 100%; height: 100%; object-fit: contain; mix-blend-mode: screen; filter: contrast(1.1) brightness(1.1); display: none; z-index: 5; transition: opacity 0.5s ease; }

        .text-side { flex: 0 0 55%; width: 55%; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; }
        .text-side::-webkit-scrollbar { width: 6px; }
        .text-side::-webkit-scrollbar-thumb { background: var(--cyan-neon); border-radius: 10px; }

        .neon-title { font-size: 42px; color: var(--text-main); margin-bottom: 20px; display: flex; align-items: center; gap: 15px; font-family: 'Space Grotesk', sans-serif;}
        .neon-title span { color: var(--cyan-neon); }
        
        /* BARRA DI PROGRESSIONE */
        .progress-wrapper { background: rgba(0,0,0,0.4); padding: 15px 20px; border-radius: 10px; border: 1px solid var(--glass-border); margin-bottom: 30px; display: flex; flex-direction: column; gap: 10px; }
        .progress-info { display: flex; justify-content: space-between; font-family: 'VT323', monospace; font-size: 24px; color: var(--text-main); letter-spacing: 2px; }
        .progress-track { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); box-shadow: 0 0 10px currentColor; }

        /* TASK CARDS */
        .task-list-container { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
        .task-card { background: rgba(5, 5, 5, 0.6); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px 25px; padding-left: 55px; cursor: pointer; transition: all 0.3s ease; position: relative; }
        .task-card::before { content: '>'; position: absolute; left: 20px; top: 22px; color: var(--text-muted); font-family: 'Space Grotesk', sans-serif; font-weight: bold; font-size: 24px; transition: color 0.3s; }
        .task-card-title { font-size: 24px; color: var(--text-main); font-weight: 700; margin-bottom: 8px; transition: color 0.3s; font-family: 'Space Grotesk', sans-serif;}
        .task-card-desc { font-size: 17px; color: var(--text-muted); line-height: 1.4; transition: color 0.3s; }
        
        /* Stato completato */
        .task-card.completed { opacity: 0.6; border-color: var(--glass-border) !important; background: transparent !important; transform: scale(0.98); box-shadow: none !important;}
        .task-card.completed .confirm-btn { color: currentColor; border-color: transparent; pointer-events: none; }

        .task-card:not(.completed):hover { background: rgba(0, 243, 255, 0.05); border-color: var(--cyan-neon); box-shadow: 0 0 15px rgba(0, 243, 255, 0.15); transform: translateX(5px); }
        .task-card:not(.completed):hover::before, .task-card:not(.completed):hover .task-card-title { color: var(--cyan-neon); }
        .task-card.active:not(.completed) { border-color: var(--cyan-neon); background: rgba(0, 243, 255, 0.1); transform: translateX(5px); box-shadow: inset 0 0 15px rgba(0,243,255,0.1); }
        .task-card.active:not(.completed)::before, .task-card.active:not(.completed) .task-card-title { color: var(--cyan-neon); }

        .confirm-btn { margin-top: 15px; background: transparent; border: 1px solid var(--text-muted); color: var(--text-muted); padding: 8px 15px; border-radius: 6px; font-family: 'Space Grotesk', sans-serif; font-size: 14px; text-transform: uppercase; font-weight: bold; transition: all 0.3s; display: flex; align-items: center; gap: 8px; width: fit-content;}
        .btn-icon { width: 18px; height: 18px; }

        /* Colori per Terapie */
        .theme-cyan .neon-title span, .theme-cyan .progress-info span { color: var(--cyan-neon); }
	.theme-cyan .progress-bar { background-color: var(--cyan-neon); }
        .theme-cyan .task-card:not(.completed):hover .confirm-btn, .theme-cyan .task-card.active:not(.completed) .confirm-btn { color: var(--cyan-neon); border-color: var(--cyan-neon); }
        .theme-cyan .task-card.completed .confirm-btn { color: var(--cyan-neon); }

        .theme-green .neon-title span, .theme-green .progress-info span { color: var(--green-neon); }
        .theme-green .progress-bar { background-color: var(--green-neon); }
        .theme-green .task-card:not(.completed):hover, .theme-green .task-card.active:not(.completed) { border-color: var(--green-neon); }
        .theme-green .task-card:not(.completed):hover::before, .theme-green .task-card.active:not(.completed)::before, .theme-green .task-card:not(.completed):hover .task-card-title, .theme-green .task-card.active:not(.completed) .task-card-title { color: var(--green-neon); }
        .theme-green .task-card.active:not(.completed) { background: rgba(57, 255, 20, 0.08); box-shadow: inset 0 0 20px rgba(57,255,20,0.1); }
        .theme-green .task-card:not(.completed):hover .confirm-btn, .theme-green .task-card.active:not(.completed) .confirm-btn { color: var(--green-neon); border-color: var(--green-neon); }
        .theme-green .task-card.completed .confirm-btn { color: var(--green-neon); }
        .theme-green .video-side { box-shadow: inset 0 0 60px rgba(57, 255, 20, 0.05); }

        .theme-red .neon-title span, .theme-red .progress-info span { color: var(--warning-neon); }
        .theme-red .progress-bar { background-color: var(--warning-neon); }
        .theme-red .task-card:not(.completed):hover, .theme-red .task-card.active:not(.completed) { border-color: var(--warning-neon); }
        .theme-red .task-card:not(.completed):hover::before, .theme-red .task-card.active:not(.completed)::before, .theme-red .task-card:not(.completed):hover .task-card-title, .theme-red .task-card.active:not(.completed) .task-card-title { color: var(--warning-neon); }
        .theme-red .task-card.active:not(.completed) { background: rgba(255, 51, 102, 0.08); box-shadow: inset 0 0 20px rgba(255, 51, 102, 0.1); }
        .theme-red .task-card:not(.completed):hover .confirm-btn, .theme-red .task-card.active:not(.completed) .confirm-btn { color: var(--warning-neon); border-color: var(--warning-neon); }
        .theme-red .task-card.completed .confirm-btn { color: var(--warning-neon); }
        .theme-red .video-side { box-shadow: inset 0 0 60px rgba(255, 51, 102, 0.05); }

        /* SCHERMATA SUCCESSO */
        #success-modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10000; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; backdrop-filter: blur(10px); }
        #success-modal h1 { color: var(--green-neon); font-size: 60px; font-family: 'Space Grotesk'; margin-bottom: 20px; text-shadow: 0 0 40px rgba(57,255,20,0.6); }
        #success-modal p { color: var(--text-main); font-size: 24px; margin-bottom: 40px; font-family: 'Rajdhani'; }
        .modal-btn { background: var(--green-neon); color: var(--bg-color); border: none; padding: 20px 40px; border-radius: 10px; font-size: 20px; font-weight: bold; font-family: 'Space Grotesk'; text-transform: uppercase; box-shadow: 0 0 20px var(--green-neon); transition: 0.3s; }
        .modal-btn:hover { transform: scale(1.05); box-shadow: 0 0 40px var(--green-neon); }

        /* SVG NASCOSTI PER I BOTTONI */
        svg.defs { display: none; }

        @media (max-width: 1200px) {
            * { cursor: auto !important; }
            .cursor-ring { display: none !important; }
            body { overflow: auto; height: auto;}
            .content-container { height: auto; }
            .hub-layout { flex-direction: column; height: auto; }
            .mascot-container { width: 100%; height: 350px; }
            .therapy-display { flex-direction: column; height: auto; border: none; background: transparent; box-shadow: none; backdrop-filter: none; }
            .video-side { width: 100%; height: 40vh; border-right: none; border-bottom: 2px solid var(--glass-border); border-radius: 15px 15px 0 0; background: rgba(0,0,0,0.8); }
            .text-side { width: 100%; padding: 30px 0; overflow-y: visible; }
            .hud-arc, .hud-reticle-top { display: none; }
            header { flex-direction: column; gap: 15px; padding: 15px 20px; position: relative; height: auto;}
            .header-actions, .logo, .hud-status { position: relative; left: auto; right: auto; top: auto; transform: none; text-align: center; justify-content: center; flex-wrap: wrap;}
        }
    </style>
</head>
<body>

    <svg class="defs">
        <symbol id="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
        </symbol>
        <symbol id="icon-uncheck" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
        </symbol>
    </svg>

    <div class="cursor-ring" id="cursor-ring"></div>

    <div class="hud-overlay">
        <div class="hud-arc arc-left"></div>
        <div class="hud-arc arc-right"></div>
        <div class="hud-reticle-top"><div class="reticle-line"></div><div class="reticle-center"></div><div class="reticle-line"></div></div>
    </div>

    <header>
        <div class="hud-status">
            <div class="status-dot"></div>Sistema: Online
        </div>
        
        <a href="1.html" class="logo interactive-el">BAIONICOL</a>
        
        <div class="header-actions">
            <div id="profile-badge" class="profile-badge interactive-el" onclick="resetProfile()">[⚙️ Profilo]</div>
            <a href="paziente.html?return=true" class="back-btn interactive-el" id="btn-back-paziente">&larr; Area Paziente</a>
            <button class="back-btn hidden interactive-el" id="btn-back-menu" onclick="showMenu()">&#8634; Cambia Terapia</button>
        </div>
    </header>

    <div id="success-modal">
        <h1>SINCRONIZZAZIONE COMPLETATA</h1>
        <p>Terapia neurale eseguita correttamente. I dati sono stati inviati al tuo registro sessioni.</p>
        <button class="modal-btn interactive-el" onclick="chiudiModalEShowHub()">Aggiorna Livello e Torna alla Libreria</button>
    </div>

    <div class="content-container">

        <div id="view-menu" class="view-section">
            <h1 class="hub-title">Protocolli di Ricalibrazione Neurale</h1>
            <div class="hub-layout">
                
                <div class="mascot-container">
                    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.12.60/build/spline-viewer.js"></script>
			<spline-viewer url="https://prod.spline.design/eto9tA806aaR8HFr/scene.splinecode"></spline-viewer>
                </div>

                <div class="options-container">
                    <button class="therapy-btn btn-tessuti interactive-el" onclick="showTherapy('tessuti')">
                        <svg class="therapy-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><circle cx="12" cy="11" r="3"/>
                        </svg>
                        <div>
                            <h2>1. Preparazione Tessuti</h2>
                            <p>Desensibilizzazione e massaggio cicatriziale pre-protesico.</p>
                        </div>
                    </button>

                    <button class="therapy-btn btn-specchio interactive-el" onclick="showTherapy('specchio')">
                        <svg class="therapy-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2v20"/><path d="M5 6h5v12H5z"/><path d="M14 6h5v12h-5z" stroke-dasharray="4 4"/>
                        </svg>
                        <div>
                            <h2>2. Terapia a Specchio</h2>
                            <p>Ricalibrazione neurale per il controllo del dolore fantasma.</p>
                        </div>
                    </button>

                    <button class="therapy-btn btn-elettro interactive-el" onclick="showTherapy('elettro')">
                        <svg class="therapy-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <div>
                            <h2>3. Elettrostimolazione</h2>
                            <p>Stimolazione periferica dei segnali mioelettrici.</p>
                            <p class="warning-text" style="color: var(--warning-neon); font-size: 14px; margin-top: 5px;">⚠️ Richiede dispositivo EMG-FES esterno.</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <div id="view-tessuti" class="view-section hidden theme-cyan">
            <div class="therapy-display">
                <div class="video-side">
                    <div class="video-placeholder-text">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        [ IN ATTESA DI<br>INPUT CLINICO ]
                    </div>
                    <video id="video-tessuti" preload="metadata" src="" autoplay loop muted playsinline></video>
                </div>
                
                <div class="text-side">
                    <h2 class="neon-title"><span>01.</span> Desensibilizzazione</h2>
                    
                    <div class="progress-wrapper">
                        <div class="progress-info">
                            <span>Sincronizzazione Modulo</span><span id="prog-text-tessuti">0%</span>
                        </div>
                        <div class="progress-track"><div class="progress-bar" id="prog-bar-tessuti"></div></div>
                    </div>
                    
                    <div class="task-list-container">
                        <div class="task-card interactive-el" onclick="playVideo('view-tessuti', 'video-tessuti', 'Tapping.mp4', this)">
                            <div class="task-card-title">1. Tapping (Picchiettamento)</div>
                            <div class="task-card-desc" id="tes-desc-1">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'tessuti')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>
                        
                        <div class="task-card interactive-el" onclick="playVideo('view-tessuti', 'video-tessuti', 'massaggio.profondo1.mp4', this)">
                            <div class="task-card-title">2. Massaggio Profondo</div>
                            <div class="task-card-desc" id="tes-desc-2">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'tessuti')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>

                        <div class="task-card interactive-el" onclick="playVideo('view-tessuti', 'video-tessuti', 'video_placeholder_guaina.mp4', this)">
                            <div class="task-card-title">3. Guaina Compressiva</div>
                            <div class="task-card-desc" id="tes-desc-3">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'tessuti')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-specchio" class="view-section hidden theme-green">
            <div class="therapy-display">
                <div class="video-side">
                    <div class="video-placeholder-text" style="color: var(--green-neon);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        [ IN ATTESA DI<br>INPUT CLINICO ]
                    </div>
                    <video id="video-specchio" preload="metadata" src="" autoplay loop muted playsinline></video>
                </div>
                
                <div class="text-side">
                    <h2 class="neon-title"><span>02.</span> Mirror Therapy</h2>
                    
                    <div class="progress-wrapper">
                        <div class="progress-info">
                            <span>Sincronizzazione Modulo</span><span id="prog-text-specchio">0%</span>
                        </div>
                        <div class="progress-track"><div class="progress-bar" id="prog-bar-specchio"></div></div>
                    </div>
                    
                    <div class="task-list-container">
                        <div class="task-card interactive-el" onclick="playVideo('view-specchio', 'video-specchio', 'PosizionamentoMirror.mp4', this)">
                            <div class="task-card-title">1. Posizionamento</div>
                            <div class="task-card-desc">Posiziona l'arto intatto davanti allo specchio e il moncone nascosto dietro di esso. Rilassa la muscolatura.</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'specchio')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>
                        
                        <div class="task-card interactive-el" onclick="playVideo('view-specchio', 'video-specchio', 'MovimentiAttivi.mp4', this)">
                            <div class="task-card-title">2. Movimenti Attivi</div>
                            <div class="task-card-desc" id="mirror-desc-2">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'specchio')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>

                        <div class="task-card interactive-el" onclick="playVideo('view-specchio', 'video-specchio', 'video_placeholder_specchio3.mp4', this)">
                            <div class="task-card-title">3. Imitazione Mentale</div>
                            <div class="task-card-desc" id="mirror-desc-3">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'specchio')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-elettro" class="view-section hidden theme-red">
            <div class="therapy-display">
                <div class="video-side">
                    <div class="video-placeholder-text" style="color: var(--warning-neon);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        [ IN ATTESA DI<br>INPUT CLINICO ]
                    </div>
                    <video id="video-elettro" preload="metadata" src="" autoplay loop muted playsinline></video>
                </div>
                
                <div class="text-side">
                    <h2 class="neon-title"><span>03.</span> Elettrostimolazione FES</h2>
                    
                    <div class="progress-wrapper">
                        <div class="progress-info">
                            <span>Sincronizzazione Modulo</span><span id="prog-text-elettro">0%</span>
                        </div>
                        <div class="progress-track"><div class="progress-bar" id="prog-bar-elettro"></div></div>
                    </div>

                    <div class="task-list-container">
                        <div class="task-card interactive-el" onclick="playVideo('view-elettro', 'video-elettro', 'video_placeholder_fes1.mp4', this)">
                            <div class="task-card-title">1. Applicazione Elettrodi</div>
                            <div class="task-card-desc" id="ele-desc-1">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'elettro')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>
                        
                        <div class="task-card interactive-el" onclick="playVideo('view-elettro', 'video-elettro', 'video_placeholder_fes2.mp4', this)">
                            <div class="task-card-title">2. Intenzione Motoria</div>
                            <div class="task-card-desc" id="ele-desc-2">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'elettro')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>

                        <div class="task-card interactive-el" onclick="playVideo('view-elettro', 'video-elettro', 'video_placeholder_fes3.mp4', this)">
                            <div class="task-card-title">3. Impulso Assistito</div>
                            <div class="task-card-desc" id="ele-desc-3">Caricamento protocolli...</div>
                            <button class="confirm-btn interactive-el" onclick="event.stopPropagation(); completeExercise(this, 'elettro')">
                                <svg class="btn-icon"><use href="#icon-uncheck"></use></svg> Segna Completato
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ==========================================
        // 1. MEMORIA PROFILO E TESTI CAMALEONTICI
        // ==========================================
        window.addEventListener('load', () => {
            const profile = localStorage.getItem('baionicol_profile');
            
            if (!profile) { window.location.href = '1.html'; return; }

            const badge = document.getElementById('profile-badge');
            badge.style.display = 'block';
            
            // LA MAGIA CAMALEONTICA: Cambia TUTTI i testi in base al profilo
            if(profile === 'superiore') {
                badge.innerText = "[⚙️ Profilo: Arto Superiore]";
                
                // Tessuti
                document.getElementById('tes-desc-1').innerText = "Esegui leggeri colpi con i polpastrelli sull'apice del moncone brachiale per desensibilizzare i nervi di superficie.";
                document.getElementById('tes-desc-2').innerText = "Applica pressione sulle cicatrici dell'avambraccio/braccio per smuovere i tessuti profondi.";
                document.getElementById('tes-desc-3').innerText = "Indossa la guaina compressiva per l'arto superiore costantemente per stabilizzare i volumi.";
                
                // Specchio
                document.getElementById('mirror-desc-2').innerText = "Esegui movimenti di apertura/chiusura delle dita e rotazioni del polso con l'arto sano.";
                document.getElementById('mirror-desc-3').innerText = "Guarda intensamente il riflesso, imitando mentalmente l'azione con la mano amputata.";
                
                // Elettro
                document.getElementById('ele-desc-1').innerText = "Applica gli elettrodi sui ventri muscolari dell'avambraccio (flessori ed estensori).";
                document.getElementById('ele-desc-2').innerText = "Tenta volontariamente e con forza di aprire e chiudere la mano fantasma.";
                document.getElementById('ele-desc-3').innerText = "Lascia che l'impulso del macchinario completi la chiusura della presa.";
            } else {
                badge.innerText = "[⚙️ Profilo: Arto Inferiore]";
                
                // Tessuti
                document.getElementById('tes-desc-1').innerText = "Esegui leggeri colpi con i polpastrelli sull'apice tibiale o femorale per desensibilizzare l'area di carico.";
                document.getElementById('tes-desc-2').innerText = "Applica pressione sulle cicatrici della gamba per smuovere i tessuti e prevenire aderenze ossee.";
                document.getElementById('tes-desc-3').innerText = "Indossa la guaina compressiva (shrinker) per l'arto inferiore costantemente.";
                
                // Specchio
                document.getElementById('mirror-desc-2').innerText = "Esegui movimenti di flesso-estensione della caviglia e muovi le dita del piede con l'arto sano.";
                document.getElementById('mirror-desc-3').innerText = "Guarda intensamente il riflesso, imitando mentalmente l'azione con il piede amputato.";
                
                // Elettro
                document.getElementById('ele-desc-1').innerText = "Applica gli elettrodi sui ventri muscolari del quadricipite, femorale o polpaccio.";
                document.getElementById('ele-desc-2').innerText = "Tenta volontariamente di flettere ed estendere il ginocchio/piede fantasma.";
                document.getElementById('ele-desc-3').innerText = "Lascia che l'impulso elettrico completi l'estensione dell'arto inferiore.";
            }

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('return') === 'true') {
                document.body.classList.add('zoom-out-start');
                void document.body.offsetWidth; 
                document.body.classList.remove('zoom-out-start');
                document.body.classList.add('zoom-normal');
            }
        });

        function resetProfile() {
            if(confirm("Vuoi ricalibrare l'architettura del sistema? Verrai reindirizzato al terminale principale.")) {
                localStorage.removeItem('baionicol_profile');
                window.location.href = '1.html';
            }
        }

        
        // ==========================================
        // 3. GESTIONE VISTE E MENU
        // ==========================================
        function showTherapy(therapyId) {
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('btn-back-paziente').classList.add('hidden');
            document.getElementById('profile-badge').classList.add('hidden');
            document.getElementById('btn-back-menu').classList.remove('hidden');
            
            resetRoutine(therapyId);

            const view = document.getElementById('view-' + therapyId);
            view.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showMenu() {
            document.getElementById('view-tessuti').classList.add('hidden');
            document.getElementById('view-specchio').classList.add('hidden');
            document.getElementById('view-elettro').classList.add('hidden');
            document.getElementById('btn-back-menu').classList.add('hidden');
            document.getElementById('btn-back-paziente').classList.remove('hidden');
            document.getElementById('profile-badge').classList.remove('hidden');
            document.getElementById('view-menu').classList.remove('hidden');
        }

        // ==========================================
        // 4. RIPRODUZIONE VIDEO E GAMIFICATION
        // ==========================================
        function playVideo(viewId, videoElementId, videoSrc, clickedCard) {
            SoundEngine.click();
            const videoElement = document.getElementById(videoElementId);
            const placeholder = videoElement.parentElement.querySelector('.video-placeholder-text');
            
            const allCards = document.querySelectorAll(`#${viewId} .task-card`);
            allCards.forEach(card => card.classList.remove('active'));
            clickedCard.classList.add('active');

            videoElement.pause();
            videoElement.style.display = 'none';
            videoElement.style.opacity = '0';
            
            SoundEngine.dataLoad();

            if(placeholder) {
                placeholder.style.display = 'flex';
                let blinkCount = 0;
                let blinkInterval = setInterval(() => {
                    placeholder.style.opacity = placeholder.style.opacity === '0.1' ? '0.8' : '0.1';
                    blinkCount++;
                    if(blinkCount > 8) { 
                        clearInterval(blinkInterval);
                        placeholder.style.display = 'none';
                        videoElement.style.display = 'block';
                        videoElement.src = videoSrc;
                        videoElement.play();
                        setTimeout(() => { videoElement.style.opacity = '1'; }, 50);
                    }
                }, 70); 
            }
        }

        const checkSvg = `<svg class="btn-icon"><use href="#icon-check"></use></svg>`;
        const uncheckSvg = `<svg class="btn-icon"><use href="#icon-uncheck"></use></svg>`;

        function completeExercise(btn, therapyId) {
            const card = btn.closest('.task-card');
            card.classList.add('completed');
            btn.innerHTML = `${checkSvg} COMPLETATO`;

            const container = document.getElementById('view-' + therapyId);
            const total = container.querySelectorAll('.task-card').length;
            const completed = container.querySelectorAll('.task-card.completed').length;
            const perc = Math.round((completed / total) * 100);
            
            document.getElementById('prog-bar-' + therapyId).style.width = perc + '%';
            document.getElementById('prog-text-' + therapyId).innerText = perc + '%';

            if(perc === 100) {
                SoundEngine.success();
                setTimeout(() => { document.getElementById('success-modal').style.display = 'flex'; }, 800);
            }
        }

        function chiudiModalEShowHub() {
            // Aggiunge +1 alla Sincronizzazione Neurale di paziente.html
            let currentSessions = parseInt(localStorage.getItem('baionicol_sessions')) || 0;
            localStorage.setItem('baionicol_sessions', currentSessions + 1);
            
            document.getElementById('success-modal').style.display = 'none';
            showMenu();
        }

        function resetRoutine(therapyId) {
            const container = document.getElementById('view-' + therapyId);
            
            const placeholder = container.querySelector('.video-placeholder-text');
            const video = container.querySelector('video');
            if(placeholder) { placeholder.style.display = 'flex'; placeholder.style.opacity = '0.6'; }
            if(video) { video.style.display = 'none'; video.pause(); video.src = ''; }

            const cards = container.querySelectorAll('.task-card');
            cards.forEach(card => {
                card.classList.remove('active', 'completed');
                const btn = card.querySelector('.confirm-btn');
                btn.innerHTML = `${uncheckSvg} Segna Completato`;
            });
            
            document.getElementById('prog-bar-' + therapyId).style.width = '0%';
            document.getElementById('prog-text-' + therapyId).innerText = '0%';
        }
    </script>
<script src="baionicol-core.js"></script>
</body>
</html>