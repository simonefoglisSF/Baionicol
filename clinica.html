<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area Clinica | BAIONICOL</title>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="stylesheet" href="baionicol-core.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Space+Grotesk:wght@500;700&family=VT323&display=swap" rel="stylesheet">
    
    <style>
                /* --- HUD OVERLAY PERIFERICO --- */
        .hud-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 999; box-shadow: inset 0 0 150px rgba(0,0,0,0.95); overflow: hidden; }
        .hud-arc { position: absolute; top: -10vh; width: 15vw; height: 120vh; border-radius: 50%; opacity: 0.15; transition: border-color 0.5s, filter 0.5s; }
        .arc-left { left: -7.5vw; border-right: 3px solid var(--blue-neon); filter: drop-shadow(0 0 10px var(--blue-neon)); }
        .arc-right { right: -7.5vw; border-left: 3px solid var(--blue-neon); filter: drop-shadow(0 0 10px var(--blue-neon)); }
        .defcon-mode .arc-left { border-right-color: var(--danger-neon); filter: drop-shadow(0 0 10px var(--danger-neon)); }
        .defcon-mode .arc-right { border-left-color: var(--danger-neon); filter: drop-shadow(0 0 10px var(--danger-neon)); }

        /* --- CONTENITORE PRINCIPALE --- */
        .content-container { 
            height: 100vh; width: 100vw; display: flex; align-items: center; justify-content: center; 
            padding-top: 80px; position: relative; z-index: 10;
        }
        
        .view-section { transition: opacity 0.4s ease, transform 0.4s ease; display: none; opacity: 0; transform: scale(0.98); width: 100%; max-width: 1500px; padding: 0 4vw;}
        .view-section.active { display: flex; opacity: 1; transform: scale(1); flex-direction: column; align-items: center;}

        /* --- VISTA 1: HUB PRINCIPALE --- */
        .hub-title { text-align: center; font-size: 42px; color: var(--text-main); margin-bottom: 40px; text-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .hub-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; width: 100%; }
        
        .hub-card {
            background: rgba(10, 10, 10, 0.8); border: 1px solid var(--glass-border); border-radius: 15px;
            padding: 50px 30px; text-align: center; cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            min-height: 380px; position: relative; overflow: hidden;
        }
        
        /* Effetto Laser Scanline Continuo */
        .hub-card::after { content: ''; position: absolute; top: -50%; left: 0; width: 100%; height: 2px; filter: blur(2px); opacity: 0.3; animation: scan 3s linear infinite; pointer-events: none;}
        @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }

        .hub-card svg { width: 75px; height: 75px; margin-bottom: 25px; transition: all 0.3s; position: relative; z-index: 2; }
        .hub-card h2 { font-size: 28px; margin-bottom: 15px; transition: color 0.3s; position: relative; z-index: 2; font-family: 'Space Grotesk'; letter-spacing: 1px;}
        .hub-card p { font-size: 17px; color: var(--text-muted); line-height: 1.5; position: relative; z-index: 2; }

        .card-batt { border-color: rgba(255, 170, 0, 0.3); }
        .card-batt svg { color: var(--amber-neon); filter: drop-shadow(0 0 10px rgba(255, 170, 0, 0.5)); }
        .card-batt::after { background: var(--amber-neon); box-shadow: 0 0 15px var(--amber-neon); }
        .card-batt:hover { border-color: var(--amber-neon); box-shadow: 0 10px 40px rgba(255, 170, 0, 0.15); transform: translateY(-10px); background: rgba(255, 170, 0, 0.05); }
        .card-batt:hover h2 { color: var(--amber-neon); }

        .card-liner { border-color: rgba(0, 136, 255, 0.3); }
        .card-liner svg { color: var(--blue-neon); filter: drop-shadow(0 0 10px rgba(0, 136, 255, 0.5)); }
        .card-liner::after { background: var(--blue-neon); box-shadow: 0 0 15px var(--blue-neon); animation-delay: 1s;}
        .card-liner:hover { border-color: var(--blue-neon); box-shadow: 0 10px 40px rgba(0, 136, 255, 0.15); transform: translateY(-10px); background: rgba(0, 136, 255, 0.05); }
        .card-liner:hover h2 { color: var(--blue-neon); }

        /* L'emergenza pulsa leggermente per attirare l'attenzione */
        .card-emerg { border-color: rgba(255, 51, 51, 0.4); background: rgba(26, 0, 0, 0.5); animation: emergPulse 2s infinite; }
        @keyframes emergPulse { 0%, 100% { box-shadow: 0 0 10px rgba(255, 51, 51, 0.1); } 50% { box-shadow: 0 0 25px rgba(255, 51, 51, 0.3); } }
        .card-emerg svg { color: var(--danger-neon); filter: drop-shadow(0 0 10px rgba(255, 51, 51, 0.5)); }
        .card-emerg::after { background: var(--danger-neon); box-shadow: 0 0 15px var(--danger-neon); animation-delay: 2s;}
        .card-emerg:hover { border-color: var(--danger-neon); box-shadow: 0 10px 40px rgba(255, 51, 51, 0.4); transform: translateY(-10px); background: rgba(255, 51, 51, 0.15); animation: none; }
        .card-emerg:hover h2 { color: var(--danger-neon); }

        .defcon-mode .clinica-grid, .defcon-mode .bottom-actions { opacity: 0.1; pointer-events: none; filter: blur(3px); }

        /* --- STILI MODULI A SCHERMO INTERO --- */
        .module-layout { display: flex; flex-direction: column; width: 100%; max-width: 800px;}
        
        .diag-panel {
            background: rgba(5, 5, 5, 0.85); border: 1px solid; border-radius: 12px; 
            padding: 30px 40px; backdrop-filter: blur(15px); box-shadow: 0 20px 40px rgba(0,0,0,0.8); 
            display: flex; flex-direction: column; width: 100%;
        }

        .panel-hardware { border-color: var(--amber-neon); box-shadow: 0 20px 40px rgba(0,0,0,0.6), inset 0 0 20px rgba(255, 170, 0, 0.05); }
        .panel-interface { border-color: var(--blue-neon); box-shadow: 0 20px 40px rgba(0,0,0,0.6), inset 0 0 20px rgba(0, 136, 255, 0.05); }
        
        .panel-title { font-family: 'VT323', monospace; font-size: 32px; margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;}
        .panel-hardware .panel-title { color: var(--amber-neon); border-bottom: 1px solid rgba(255, 170, 0, 0.3); }
        .panel-interface .panel-title { color: var(--blue-neon); border-bottom: 1px solid rgba(0, 136, 255, 0.3); }

        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-size: 15px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; font-weight: 700;}
        select, input[type="number"] { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); color: var(--text-main); padding: 12px 15px; border-radius: 6px; font-family: 'Space Grotesk'; font-size: 16px; outline: none; transition: 0.3s; appearance: none; cursor: pointer; }
        select optgroup { background: #111111; color: var(--blue-neon); font-family: 'Rajdhani'; font-weight: bold; }
        select option { background: #050505; color: var(--text-main); font-weight: normal; }
        select:focus, input[type="number"]:focus { border-color: var(--amber-neon); box-shadow: 0 0 10px rgba(255, 170, 0, 0.2); }
        
        .radio-group { display: flex; gap: 10px; }
        .radio-btn { flex: 1; text-align: center; padding: 12px 5px; border: 1px solid var(--glass-border); border-radius: 6px; cursor: pointer; color: var(--text-muted); transition: 0.3s; font-size: 14px; display: flex; flex-direction: column; gap: 4px; align-items: center; justify-content: center;}
        .radio-btn.selected { background: rgba(255, 170, 0, 0.1); border-color: var(--amber-neon); color: var(--amber-neon); font-weight: bold; box-shadow: 0 0 10px rgba(255, 170, 0, 0.2); }
        .radio-btn span:nth-child(2) { font-size: 12px; }

        .symptom-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px;}
        .symptom-btn { background: rgba(0,0,0,0.6); border: 1px solid var(--glass-border); color: var(--text-main); padding: 15px 10px; border-radius: 6px; font-family: 'Space Grotesk'; font-size: 15px; cursor: pointer; transition: 0.3s; text-align: center; }
        .symptom-btn:hover { background: rgba(0, 136, 255, 0.1); border-color: var(--blue-neon); color: var(--blue-neon); box-shadow: 0 0 10px rgba(0, 136, 255, 0.2); transform: translateY(-2px);}
        .symptom-btn.selected { background: rgba(0, 136, 255, 0.2); border-color: var(--blue-neon); color: var(--blue-neon); box-shadow: 0 0 15px rgba(0, 136, 255, 0.4); transform: translateY(-2px);}

        .action-btn { width: 100%; padding: 15px; border-radius: 6px; font-family: 'Space Grotesk'; font-size: 20px; text-transform: uppercase; letter-spacing: 2px; font-weight: bold; transition: 0.3s; margin-top: 10px; cursor: pointer; }
        .btn-hardware { background: rgba(255, 170, 0, 0.1); border: 2px solid var(--amber-neon); color: var(--amber-neon); }
        .btn-hardware:hover { background: var(--amber-neon); color: var(--bg-color); box-shadow: 0 0 20px var(--amber-neon); }
        
        .diag-result { margin-top: 20px; padding-top: 25px; border-top: 1px dashed rgba(255,255,255,0.15); font-family: 'Rajdhani', sans-serif; display: none; }
        .result-text { font-size: 20px; letter-spacing: 0.5px; line-height: 1.6; color: var(--text-main); margin-bottom: 20px; }
        .result-title { font-family: 'VT323', monospace; font-size: 28px; margin-bottom: 5px; }

        .gauge-container { position: relative; width: 130px; height: 130px; margin: 15px auto; display: none; justify-content: center; align-items: center; }
        .battery-gauge { width: 100%; height: 100%; transform: rotate(-90deg); overflow: visible; }
        .gauge-bg { fill: none; stroke: rgba(255, 255, 255, 0.1); stroke-width: 6; }
        .gauge-fill { fill: none; stroke: var(--amber-neon); stroke-width: 6; stroke-linecap: round; stroke-dasharray: 339.292; stroke-dashoffset: 339.292; transition: stroke-dashoffset 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), stroke 0.5s, filter 0.5s; }
        .gauge-percentage { position: absolute; font-family: 'VT323', monospace; font-size: 38px; color: var(--text-main); text-shadow: 0 0 10px rgba(255,255,255,0.5); }

        .btn-ticket-inline { background: rgba(0,0,0,0.3); border: 2px solid currentColor; color: currentColor; padding: 15px; border-radius: 8px; font-family: 'Space Grotesk'; font-size: 18px; letter-spacing: 1px; text-transform: uppercase; margin-top: 25px; width: 100%; cursor: pointer; transition: 0.3s; display: none; text-align: center; font-weight: bold;}
.btn-ticket-inline:hover { box-shadow: 0 0 20px currentColor; filter: brightness(1.2); }

        /* --- VISTA EMERGENZA (PROTOCOLLO) --- */
        .emergency-fullscreen { 
            max-width: 900px; width: 100%; background: rgba(20, 0, 0, 0.9); 
            border: 2px solid var(--danger-neon); padding: 40px; border-radius: 12px; 
            box-shadow: 0 0 60px rgba(255, 51, 51, 0.4); backdrop-filter: blur(15px); 
            position: relative; overflow: hidden;
        }
        /* Nastro di pericolo superiore */
        .emergency-fullscreen::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 8px;
            background: repeating-linear-gradient(45deg, var(--danger-neon), var(--danger-neon) 15px, #000 15px, #000 30px);
        }

        .emergency-header { color: var(--danger-neon); font-family: 'Space Grotesk'; font-size: 38px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; margin-top: 10px;}
        
        .glitch-text { display: inline-block; position: relative; }
        .glitch-text::before, .glitch-text::after { content: attr(data-text); position: absolute; top: 0; left: 0; opacity: 0.8; }
        .glitch-text::before { color: var(--cyan-neon); z-index: -1; transform: translate(-2px, 1px); animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite; }
        .glitch-text::after { color: var(--amber-neon); z-index: -2; transform: translate(2px, -1px); animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) reverse both infinite; }
        @keyframes glitch { 0% { transform: translate(0) } 20% { transform: translate(-2px, 2px) } 40% { transform: translate(-2px, -2px) } 60% { transform: translate(2px, 2px) } 80% { transform: translate(2px, -2px) } 100% { transform: translate(0) } }

        .emergency-desc { color: var(--text-muted); font-size: 18px; margin-bottom: 30px; line-height: 1.5; border-bottom: 1px solid rgba(255, 51, 51, 0.3); padding-bottom: 20px;}

        /* Stile Protocollo a Step */
        .emergency-list { display: flex; flex-direction: column; gap: 20px; margin-bottom: 35px; }
        .emerg-step { background: rgba(255, 51, 51, 0.05); border: 1px solid rgba(255, 51, 51, 0.3); border-left: 4px solid var(--danger-neon); padding: 20px; border-radius: 0 8px 8px 0; display: flex; gap: 25px; align-items: flex-start; }
        .step-num { font-family: 'VT323', monospace; font-size: 40px; color: var(--danger-neon); background: rgba(255, 51, 51, 0.15); width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; border-radius: 8px; flex-shrink: 0; line-height: 1; box-shadow: inset 0 0 10px rgba(255, 51, 51, 0.5);}
        .step-text h3 { color: var(--text-main); font-size: 22px; margin-bottom: 8px; letter-spacing: 1px; }
        .step-text p { color: var(--text-muted); font-size: 16px; line-height: 1.6; }
        .step-text strong { color: var(--danger-neon); font-family: 'Space Grotesk'; font-weight: normal; }

        .close-modal-btn { background: rgba(255, 51, 51, 0.1); border: 2px solid var(--danger-neon); color: var(--danger-neon); padding: 18px 20px; font-family: 'Space Grotesk'; font-size: 20px; cursor: pointer; transition: 0.3s; display: block; width: 100%; text-align: center; border-radius: 8px; font-weight: bold; letter-spacing: 2px;}
        .close-modal-btn:hover { background: var(--danger-neon); color: #000; box-shadow: 0 0 30px var(--danger-neon); }

        /* --- MODAL TICKET --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(10px); opacity: 0; transition: opacity 0.4s ease; }
        .ticket-box { background: #050a0f; border: 1px solid var(--blue-neon); padding: 40px; border-radius: 8px; max-width: 550px; width: 90%; font-family: 'VT323', monospace; color: var(--blue-neon); box-shadow: 0 0 40px rgba(0, 136, 255, 0.2); }
        .ticket-header { font-size: 32px; border-bottom: 2px dashed var(--blue-neon); padding-bottom: 10px; margin-bottom: 20px; text-align: center; }
        .ticket-content { font-size: 20px; line-height: 1.5; color: var(--text-main); margin-bottom: 30px; }
        .ticket-barcode { font-family: 'Libre Barcode 39 Text', cursive, monospace; font-size: 50px; text-align: center; margin-top: 20px; opacity: 0.7; letter-spacing: -2px; }
        .close-modal-btn { background: transparent; border: 1px solid currentColor; color: currentColor; padding: 12px 20px; font-family: 'Space Grotesk'; font-size: 18px; cursor: pointer; transition: 0.3s; display: block; width: 100%; text-align: center; border-radius: 5px; font-weight: bold;}
        .close-modal-btn:hover { background: currentColor; color: var(--bg-color); }

        /* SBLOCCO SCROLL SU MOBILE */
        @media (max-width: 1000px) {
            * { cursor: auto !important; }
            .cursor-ring { display: none !important; }
            body { overflow-y: auto; height: auto; display: block; }
            .content-container { height: auto; padding: 110px 20px 50px 20px; display: block; }
            .hub-grid { grid-template-columns: 1fr; }
            .symptom-grid { grid-template-columns: 1fr; }
            .radio-group { flex-direction: column; }
            .hud-arc { display: none; }
            header { flex-direction: column; gap: 15px; padding: 15px; position: relative; height: auto;}
            .header-actions, .logo, .hud-status { position: relative; left: auto; top: auto; right: auto; transform: none; text-align: center; flex-wrap: wrap; justify-content: center;}
            .view-section { transform: none; padding: 0;}
            .view-section.active { display: block; transform: none;}
        }
    </style>
</head>
<body>

    <div class="cursor-ring" id="cursor-ring"></div>

    <div class="hud-overlay">
        <div class="hud-arc arc-left"></div>
        <div class="hud-arc arc-right"></div>
    </div>

    <header>
        <div class="hud-status" id="header-status"><div class="status-dot"></div>Hub Clinico</div>
        <a href="1.html" class="logo interactive-el">BAIONICOL</a>
        <div class="header-actions">
            <div id="profile-badge" class="profile-badge interactive-el" onclick="resetProfile()">[⚙️ Profilo]</div>
            
            <a href="1.html?return=true" class="back-btn interactive-el" id="btn-back-main">&larr; Torna al Terminale</a>
            <button class="back-btn interactive-el" id="btn-back-hub" style="display: none;" onclick="showHub()">&#8634; Torna all'Hub</button>
        </div>
    </header>

    <div class="content-container">

        <div id="view-hub" class="view-section active">
		
            <h1 class="hub-title">Strumenti di Diagnostica</h1>
            <div class="hub-grid">
                
                <div class="hub-card card-batt interactive-el" onclick="switchView('view-battery', 'Diagnostica Hardware')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="16" height="10" rx="2" ry="2"></rect><line x1="22" y1="11" x2="22" y2="13"></line><line x1="6" y1="11" x2="6" y2="13"></line><line x1="10" y1="11" x2="10" y2="13"></line><line x1="14" y1="11" x2="14" y2="13"></line></svg>
                    <h2>Analisi Hardware</h2>
                    <p id="desc-hub-batt">Calcola l'usura delle celle al litio e la vita stimata della protesi.</p>
                </div>

                <div class="hub-card card-liner interactive-el" onclick="switchView('view-liner', 'Analisi Interfaccia')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><circle cx="12" cy="11" r="3"></circle></svg>
                    <h2>Analisi Interfaccia</h2>
                    <p id="desc-hub-liner">Analizzatore sintomatologico per prevenire danni tissutali al moncone.</p>
                </div>

                <div class="hub-card card-emerg interactive-el" onclick="switchView('view-emergency', 'SAFE MODE')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    <h2>Emergenza</h2>
                    <p id="desc-hub-emerg">Procedure di sblocco manuale dei giunti in caso di guasto.</p>
                </div>

            </div>
        </div>

        <div id="view-battery" class="view-section">
            <div class="module-layout">
                <div class="diag-panel panel-hardware">
                    <div class="panel-title">
                        Predittore Vita Batteria
                        <svg width="34" height="34" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="16" height="10" rx="2" ry="2"></rect><line x1="22" y1="11" x2="22" y2="13"></line></svg>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Seleziona Modello Dispositivo</label>
                        <select id="batt-device" class="interactive-el">
                            <optgroup id="opt-superiore" label="Arti Superiori (Mani e Gomiti)">
                                <option value="800" data-months="24">Ottobock - MyoEnergy Integral (Li-Ion/Po)</option>
                                <option value="800" data-months="24">Ottobock - SensorHand / VariPlus</option>
                                <option value="800" data-months="24">Ottobock - DynamicArm</option>
                                <option value="400" data-months="12">Össur - i-Limb (Li-Po)</option>
                                <option value="500" data-months="18">Steeper - Bebionic (Li-Po)</option>
                                <option value="500" data-months="24">Steeper - S-Charge / Myo Kinisi</option>
                                <option value="500" data-months="12">Taska - TASKA (Li-Ion)</option>
                                <option value="600" data-months="18">Fillauer - Motion Control</option>
                                <option value="500" data-months="18">Fillauer - Utah Arm 3/3+</option>
                            </optgroup>
                            <optgroup id="opt-inferiore" label="Arti Inferiori (Ginocchia e Caviglie)">
                                <option value="1000" data-months="36">Ottobock - C-Leg 4 (Li-Ion)</option>
                                <option value="800" data-months="24">Össur - Rheo Knee (Li-Ion)</option>
                                <option value="750" data-months="36">Blatchford - Orion3 / Elan (Li-Ion)</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Mesi di Utilizzo Attuale</label>
                        <input type="number" id="batt-months" class="interactive-el" min="1" max="60" value="6">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Abitudine di Ricarica (Profondità di Scarica)</label>
                        <div class="radio-group">
                            <div class="radio-btn interactive-el" onclick="selectRadio(this, 'good')"><span>Ricariche Frequenti (40%)</span><span style="color: var(--safe-neon);">Allunga Vita</span></div>
                            <div class="radio-btn selected interactive-el" onclick="selectRadio(this, 'average')"><span>Ricarica Serale (80%)</span><span style="color: var(--amber-neon);">Standard</span></div>
                            <div class="radio-btn interactive-el" onclick="selectRadio(this, 'bad')"><span>Fino a Spegnimento (100%)</span><span style="color: var(--danger-neon);">Danneggia</span></div>
                        </div>
                    </div>

                    <button class="action-btn btn-hardware interactive-el" id="btn-calc-batt" onclick="avviaDiagnostica()">Elabora Dati Hardware</button>

                    <div class="diag-result" id="diag-result">
                        <div class="result-title" id="diag-status-text" style="color: var(--amber-neon); text-align: center;">ESTRAZIONE DATI...</div>
                        
                        <div class="gauge-container" id="diag-gauge-container">
                            <svg class="battery-gauge" viewBox="0 0 120 120">
                                <circle class="gauge-bg" cx="60" cy="60" r="54"></circle>
                                <circle class="gauge-fill" id="gauge-fill" cx="60" cy="60" r="54"></circle>
                            </svg>
                            <div class="gauge-percentage" id="gauge-percentage">0%</div>
                        </div>

                        <div class="result-text" id="diag-desc" style="text-align: center; margin-top: 10px;"></div>
                        
                        <button class="btn-ticket-inline interactive-el" id="btn-ticket-batt" style="color: var(--amber-neon);" onclick="generateTicket('hardware')">
                            Genera Report Tecnico ➔
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-liner" class="view-section">
            <div class="module-layout">
                <div class="diag-panel panel-interface">
                    <div class="panel-title">
                        Analizzatore Interfaccia
                        <svg width="34" height="34" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><circle cx="12" cy="11" r="3"></circle></svg>
                    </div>

                    <p style="color: var(--text-main); font-size: 18px; margin-bottom: 25px; line-height: 1.5;">
                        Seleziona l'anomalia fisica che stai riscontrando per isolare il problema biomeccanico ed evitare danni ai tessuti.
                    </p>

                    <div class="symptom-grid">
                        <button class="symptom-btn interactive-el" onclick="analizzaLiner('Rumore Sfiato', 'Perdita Sottovuoto', 'Verificare l\'integrità della guarnizione della valvola. In assenza di detriti, la perdita di pressione negativa indica una micro-lacerazione del liner in silicone. Sostituzione raccomandata.', 'var(--amber-neon)', this)">Sfiato Aria</button>
                        
                        <button class="symptom-btn interactive-el" onclick="analizzaLiner('Pelle Arrossata', 'Dermatite / Attrito', 'Rilevato picco di pressione o sfregamento asimmetrico. Igienizzare con soluzione neutra. Se l\'eritema non regredisce entro 24h, è richiesta la fresatura dell\'invasatura interna per scaricare il punto di contatto.', 'var(--amber-neon)', this)">Arrossamento</button>
                        
                        <button class="symptom-btn interactive-el" onclick="analizzaLiner('Protesi Scivola', 'Variazione Volumetrica', 'Rilevata riduzione volumetrica del moncone. Compensare immediatamente la discrepanza inserendo Stump Socks (calze di spessore in cotone) per ripristinare il blocco meccanico e la sospensione.', 'var(--safe-neon)', this)">Scivolamento</button>
                        
                        <button class="symptom-btn interactive-el" onclick="analizzaLiner('Crepe Silicone', 'Usura Lieve', 'Degradazione fisiologica della matrice siliconica dovuta all\'utilizzo. Il coefficiente di attrito è ridotto ma ancora nei parametri operativi. Pianificare una sostituzione preventiva a breve termine.', 'var(--amber-neon)', this)">Silicone Liso</button>
                        
                        <button class="symptom-btn interactive-el" onclick="analizzaLiner('Sudorazione', 'Iperidrosi Termica', 'Reazione termica isolata. Rimuovere l\'invasatura e tamponare. L\'accumulo di fluidi funge da lubrificante, compromettendo gravemente la tenuta del sistema di sospensione. Valutare antitraspiranti.', 'var(--safe-neon)', this)">Sudorazione</button>
                        
                        <button class="symptom-btn interactive-el" onclick="analizzaLiner('Buchi Passanti', 'Danno Strutturale', 'Compromissione strutturale critica del liner. Il sistema di sottovuoto è inefficace e vi è un alto rischio di lesioni cutanee da trascinamento. Sospendere l\'utilizzo del carico e contattare l\'officina.', 'var(--danger-neon)', this)">Buchi nel Tessuto</button>
                    </div>

                    <div class="diag-result" id="liner-result" style="border-top-color: var(--blue-neon); margin-top: auto;">
                        <div class="result-title" id="liner-status-text" style="color: var(--blue-neon);">ELABORAZIONE...</div>
                        <div class="result-text" id="liner-desc" style="margin-bottom: 5px;"></div>
                        <div class="result-text" id="liner-action" style="font-size: 18px; color: var(--text-main); line-height: 1.5; margin-top: 10px; border-left: 3px solid; padding-left: 15px;"></div>
                        
                        <button class="btn-ticket-inline interactive-el" id="btn-ticket-liner" style="color: var(--blue-neon);" onclick="generateTicket('biomech')">
                            Genera Report Clinico ➔
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-emergency" class="view-section">
            <div class="emergency-fullscreen">
                <div class="emergency-header">
                    <svg width="45" height="45" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    <span class="glitch-text" data-text="OVERRIDE MECCANICO">OVERRIDE MECCANICO</span>
                </div>
                <p class="emergency-desc">
                    Istruzioni critiche per lo sblocco fisico dell'hardware in caso di guasto ai servomotori, esaurimento totale delle celle energetiche o mancata risposta dei sensori mioelettrici.
                </p>
                
                <div class="emergency-list">
                    <div class="emerg-step" id="emerg-inferiore">
                        <div class="step-num">01</div>
                        <div class="step-text">
                            <h3>Bypass Idraulico Ginocchio (MPK)</h3>
                            <p>In caso di spegnimento, l'articolazione entra in "Default Stance" (blocco totale) per prevenire cadute. Per flettere il ginocchio e sedersi, individuare la valvola di rilascio sul retro del cilindro idraulico e <strong>premerla con forza usando il pollice</strong> mantenendo la pressione per attivare la modalità "Free-Swing".</p>
                        </div>
                    </div>

                    <div class="emerg-step" id="emerg-superiore-1">
                        <div class="step-num">01</div>
                        <div class="step-text">
                            <h3>Rilascio Presa Mano Bionica</h3>
                            <p>Se la mano si blocca serrando un oggetto, <strong>NON tirare le dita meccaniche</strong> per evitare la rottura dei micro-motori. Tieni premuto il pulsante dorsale per 5 secondi per forzare il riavvio. Se inefficace, spingi fisicamente la base del pollice verso l'esterno per disingaggiare il blocco meccanico.</p>
                        </div>
                    </div>
                    
                    <div class="emerg-step" id="emerg-superiore-2">
                        <div class="step-num">02</div>
                        <div class="step-text">
                            <h3>Caduta Libera Gomito Elettronico</h3>
                            <p>In caso di blocco del giunto flessorio in trazione, individuare la piccola cinghia di sblocco in kevlar situata all'altezza dell'articolazione mediale. <strong>Tirare la cinghia verso il basso con uno scatto netto.</strong> L'avambraccio perderà la tensione e cadrà dolcemente in massima estensione.</p>
                        </div>
                    </div>
                </div>

                <button class="close-modal-btn interactive-el" onclick="showHub()">CHIUDI PROTOCOLLO (DISATTIVA ALLARME)</button>
            </div>
        </div>

    <div class="modal-overlay" id="modal-ticket">
        <div class="ticket-box">
            <div class="ticket-header">
                BAIONICOL SYSTEM LOG<br><span style="font-size: 18px; color: var(--text-muted);" id="ticket-date"></span>
            </div>
            <div class="ticket-content" id="ticket-data"></div>
            <button class="close-modal-btn interactive-el" id="ticket-close-btn" style="color: var(--blue-neon);" onclick="closeModals()">Archivia e Chiudi</button>
            <div class="ticket-barcode">|||||||| |||| || |||||||||| |||||</div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. MEMORIA E CONTROLLO ACCESSI (NOVITÀ)
        // ==========================================
        window.addEventListener('load', () => {
            const profile = localStorage.getItem('baionicol_profile');
            if (!profile) { window.location.href = '1.html'; return; }

            const badge = document.getElementById('profile-badge');
            badge.style.display = 'block';

            if(profile === 'superiore') {
                badge.innerText = "[⚙️ Profilo: Arto Superiore]";
                document.getElementById('desc-hub-batt').innerText = "Diagnostica celle al litio, usura micro-motori delle dita e sensori di presa.";
                document.getElementById('desc-hub-liner').innerText = "Analisi attrito avambraccio, sudorazione e calibrazione contatti mioelettrici.";
                document.getElementById('desc-hub-emerg').innerText = "Override manuale per sblocco presa mano e rilascio cinghia gomito.";
                
                document.getElementById('opt-inferiore').style.display = 'none';
                document.getElementById('emerg-inferiore').style.display = 'none';
            } else {
                badge.innerText = "[⚙️ Profilo: Arto Inferiore]";
                document.getElementById('desc-hub-batt').innerText = "Diagnostica batteria MPK, resistenza idraulica e giroscopi del ginocchio.";
                document.getElementById('desc-hub-liner').innerText = "Analisi appoggio ischiatico, tolleranza di carico e prevenzione ulcere.";
                document.getElementById('desc-hub-emerg').innerText = "Override valvola idraulica per sblocco flessione ginocchio (Free-Swing).";
                
                document.getElementById('opt-superiore').style.display = 'none';
                document.getElementById('emerg-superiore-1').style.display = 'none';
                document.getElementById('emerg-superiore-2').style.display = 'none';
            }
        });

        function resetProfile() {
            if(confirm("Vuoi ricalibrare l'architettura del sistema? Verrai reindirizzato al terminale principale.")) {
                localStorage.removeItem('baionicol_profile');
                window.location.href = '1.html';
            }
        }

        

        // ==========================================
        // 3. GESTIONE VISTE (SMISTAMENTO HUB)
        // ==========================================
        function switchView(viewId, headerTitle) {
            SoundEngine.click();
            document.querySelectorAll('.view-section').forEach(view => { view.classList.remove('active'); });
            
            setTimeout(() => {
                document.getElementById(viewId).classList.add('active');
                document.getElementById('header-status').innerHTML = `<div class="status-dot"></div>${headerTitle}`;
                document.getElementById('btn-back-main').style.display = 'none';
                document.getElementById('profile-badge').style.display = 'none'; // Nascondo badge per pulizia
                document.getElementById('btn-back-hub').style.display = 'inline-flex';

                if(viewId === 'view-emergency') {
                    document.body.classList.add('defcon-mode');
                    SoundEngine.alarm();
                } else {
                    document.body.classList.remove('defcon-mode');
                }
            }, 100);
        }

        function showHub() {
            SoundEngine.click();
            document.body.classList.remove('defcon-mode');
            document.querySelectorAll('.view-section').forEach(view => { view.classList.remove('active'); });
            
            setTimeout(() => {
                document.getElementById('view-hub').classList.add('active');
                document.getElementById('header-status').innerHTML = `<div class="status-dot"></div>Hub Clinico`;
                document.getElementById('btn-back-main').style.display = 'inline-flex';
                document.getElementById('profile-badge').style.display = 'inline-flex'; // Riappare
                document.getElementById('btn-back-hub').style.display = 'none';
            }, 100);
        }

        function softScramble(element, finalString, speed = 12) {
            const chars = 'abcdefghijklmnopqrstuvwxyz'; 
            let iterations = 0;
            const interval = setInterval(() => {
                element.innerHTML = finalString.split('').map((letter, index) => {
                    if(index < iterations) return letter;
                    if(letter === ' ' || letter === '<' || letter === '>' || letter === 'b' || letter === 'r' || letter === '/') return letter;
                    return chars[Math.floor(Math.random() * chars.length)];
                }).join('');
                iterations += 1.5; 
                if(iterations >= finalString.length) { element.innerHTML = finalString; clearInterval(interval); }
            }, speed);
        }

        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start) + "%";
                if (progress < 1) { window.requestAnimationFrame(step); }
            };
            window.requestAnimationFrame(step);
        }

        // ==========================================
        // 4. LOGICA BATTERIA
        // ==========================================
        let chargeHabit = 'average'; 
        let lastBattResult = "Nessun dato hardware registrato.";

        function selectRadio(element, habit) {
            SoundEngine.click();
            document.querySelectorAll('.radio-btn').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            chargeHabit = habit;
        }

        function avviaDiagnostica() {
            const btn = document.getElementById('btn-calc-batt');
            const resultBox = document.getElementById('diag-result');
            const statusText = document.getElementById('diag-status-text');
            const descText = document.getElementById('diag-desc');
            const gaugeContainer = document.getElementById('diag-gauge-container');
            const gaugeFill = document.getElementById('gauge-fill');
            const gaugePercentage = document.getElementById('gauge-percentage');
            const ticketBtn = document.getElementById('btn-ticket-batt');

            const deviceSelect = document.getElementById('batt-device');
            const selectedOption = deviceSelect.options[deviceSelect.selectedIndex];
            const baseMaxCycles = parseInt(selectedOption.value);
            const deviceName = selectedOption.text.split(' - ')[0]; 
            const monthsUsed = parseInt(document.getElementById('batt-months').value);
            
            let adjustedMaxCycles = baseMaxCycles;
            if (chargeHabit === 'good') adjustedMaxCycles = baseMaxCycles * 1.5; 
            else if (chargeHabit === 'bad') adjustedMaxCycles = baseMaxCycles * 0.6; 

            const usedCycles = Math.floor(monthsUsed * 30);
            let wearPercentage = Math.min((usedCycles / adjustedMaxCycles) * 100, 100);

            btn.style.display = 'none'; ticketBtn.style.display = 'none';
            resultBox.style.display = 'block'; gaugeContainer.style.display = 'flex';
            
            resultBox.style.borderColor = 'var(--text-muted)';
            statusText.innerText = "Sincronizzazione...";
            statusText.style.color = 'var(--text-muted)';
            descText.innerText = "";
            gaugeFill.style.strokeDashoffset = 339.292; 
            gaugeFill.style.stroke = "var(--text-muted)";
            gaugeFill.style.filter = "none";
            gaugePercentage.innerText = "0%";
            gaugePercentage.style.color = "var(--text-muted)";

            let beepCount = 0; let beepInterval = setInterval(() => { SoundEngine.calcBeep(); beepCount++; if(beepCount > 5) clearInterval(beepInterval); }, 150);

            setTimeout(() => {
                const circumference = 339.292;
                const offset = circumference - (wearPercentage / 100) * circumference;
                gaugeFill.style.strokeDashoffset = offset;
                animateValue(gaugePercentage, 0, wearPercentage, 1500);

                let title = ""; let desc = ""; let color = "";

                if (wearPercentage < 60) {
                    SoundEngine.resultGood(); color = "var(--safe-neon)";
                    title = "Celle Ottimali";
                    desc = `Dispositivo: ${deviceName}.<br>Cicli: ${usedCycles} / ${Math.floor(adjustedMaxCycles)}. Tensione stabile.`;
                } 
                else if (wearPercentage >= 60 && wearPercentage < 85) {
                    SoundEngine.playTone(300, 'triangle', 0.2, 0.05); color = "var(--amber-neon)";
                    title = "Degrado Fisiologico";
                    desc = `Dispositivo: ${deviceName}.<br>Cicli: ${usedCycles} / ${Math.floor(adjustedMaxCycles)}. Usura rilevata.`;
                } 
                else {
                    SoundEngine.resultBad(); color = "var(--danger-neon)";
                    title = "FINE CICLO VITALE";
                    desc = `Dispositivo: ${deviceName}.<br>Rischio spegnimento. Sostituire.`;
                }

                resultBox.style.borderTopColor = color; statusText.style.color = color; 
                gaugeFill.style.stroke = color; gaugeFill.style.filter = `drop-shadow(0 0 10px ${color})`;
                gaugePercentage.style.color = color;
                ticketBtn.style.color = color;
                lastBattResult = `${title} - ${desc.replace(/<br>/g, ' ')}`;
                statusText.innerText = title;
                softScramble(descText, desc, 10);
                setTimeout(() => { btn.style.display = 'block'; btn.innerText = "Ricalcola"; ticketBtn.style.display = 'block'; }, 2000);
            }, 1200);
        }

        // ==========================================
        // 5. LOGICA LINER
        // ==========================================
        let lastLinerResult = "Nessun dato biomeccanico registrato.";

        function analizzaLiner(sintomoTitle, diag, azione, color, btnElement) {
            SoundEngine.scanSymptom();
            document.querySelectorAll('.symptom-btn').forEach(b => b.classList.remove('selected'));
            btnElement.classList.add('selected');
            
            const resultBox = document.getElementById('liner-result');
            const titleText = document.getElementById('liner-status-text');
            const descText = document.getElementById('liner-desc');
            const actionText = document.getElementById('liner-action');
            const ticketBtn = document.getElementById('btn-ticket-liner');
            
            ticketBtn.style.display = 'none';
            resultBox.style.display = 'block';
            titleText.innerText = "ANALISI SUPERFICIE...";
            titleText.style.color = 'var(--text-muted)';
            descText.innerText = ""; actionText.innerText = "";

            setTimeout(() => {
                if(color === 'var(--safe-neon)') SoundEngine.resultGood();
                else if(color === 'var(--danger-neon)') SoundEngine.resultBad();
                else SoundEngine.playTone(300, 'triangle', 0.2, 0.05);

                titleText.innerText = "DIAGNOSI: " + diag;
                titleText.style.color = color;
                resultBox.style.borderColor = color;
                
                softScramble(descText, "Sintomo: " + sintomoTitle, 12);
                setTimeout(() => { 
                    actionText.style.borderColor = color; 
                    softScramble(actionText, azione, 12); 
                    ticketBtn.style.display = 'block';
                }, 300);

                lastLinerResult = `Sintomo: ${sintomoTitle}. Diagnosi: ${diag}. ${azione}`;
            }, 800);
        }

        // ==========================================
        // 6. GENERATORE TICKET GLOBALE
        // ==========================================
        function generateTicket(sourceType) {
            SoundEngine.printTicket();
            const modal = document.getElementById('modal-ticket');
            const dateStr = new Date().toLocaleString('it-IT');
            document.getElementById('ticket-date').innerText = "Data Compilazione: " + dateStr;
            
            let color = "";
            const profileStr = localStorage.getItem('baionicol_profile').toUpperCase();
            let content = `> ID UTENTE: BAIO-${Math.floor(Math.random()*9000)+1000}<br>> PROFILO: ${profileStr}<br>> TIPO RICHIESTA: Segnalazione Remota<br><br>`;
            
            if(sourceType === 'hardware') {
                color = "var(--amber-neon)";
                content += `[ STATUS HARDWARE ]<br>${lastBattResult}<br><br>> AZIONE: Richiesta Revisione.`;
            } else {
                color = "var(--blue-neon)";
                content += `[ STATUS BIOMECCANICO ]<br>${lastLinerResult}<br><br>> AZIONE: Controllo Invasatura.`;
            }
            
            const box = document.querySelector('.ticket-box');
            box.style.borderColor = color; box.style.color = color;
            document.getElementById('ticket-close-btn').style.color = color;
            document.querySelector('.ticket-header').style.borderBottomColor = color;
            
            modal.style.display = 'flex';
            setTimeout(() => { modal.style.opacity = '1'; }, 10);
            document.getElementById('ticket-data').innerHTML = "";
            softScramble(document.getElementById('ticket-data'), content, 5);
        }

        function closeModals() {
            SoundEngine.click();
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.style.opacity = '0';
                setTimeout(() => { modal.style.display = 'none'; }, 400);
            });
        }
    </script>
<script src="baionicol-core.js"></script>
</body>
</html>